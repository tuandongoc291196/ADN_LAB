# Schema for ADN Lab Firebase Data Connect - Users and Roles
# Chat functionality remains in Firestore

# Role table - predefined system roles
type Role @table {
  id: String! @col(name: "role_id")
  name: String! @unique
  description: String
  permissions: String # JSON string of permissions array
  isActive: Boolean! @default(value: true)
  createdAt: Timestamp! @default(expr: "request.time")
  updatedAt: Timestamp
}

# User table - keyed by Firebase Auth UID
type User @table {
  # Firebase Auth UID as primary key
  id: String! @default(expr: "auth.uid")
  fullname: String!
  gender: String
  avatar: String
  email: String! @unique
  accountStatus: String! @default(value: "active")
  authProvider: String!
  phone: String
  addressShipping: String
  
  # Role relationship
  roleId: String! @default(value: "customer")
  role: Role! @ref(fields: "roleId")
  
  # Legacy fields for backward compatibility
  isAdmin: Boolean! @default(value: false) # Deprecated: use role instead
  roleString: String! @default(value: "customer") # Deprecated: use role.name instead
  
  createdAt: Timestamp! @default(expr: "request.time")
  lastLogin: Timestamp
}